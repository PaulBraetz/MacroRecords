# MacroRecords

*Create detailed C# record types without the boilerplate.*

## Feature Overview

Addressing some of what I believe to be are shortcomings of C# record types, these are the features `MacroRecords` support:

You may:
- configure the generated constructors visibility
- configure which fields shall be included in the debugger display 
- supply your own constructor(s)
  
You may define each fields:
- name
- type
- visibility
- availability to deconstruction
- support for the `withX(T x)` syntax
- inclusion in the debugger display
- inclusion in validation 

The source code generated (depending on your definitions) includes:
- a constructor
- `DebuggerDisplayAttribute`
- static methods `Create`, `TryCreate`, `IsValid`
- methods `WithX(x value)`
- a `Deconstruct(out x value1, out y value2)`
- an `implicit` conversion operator
- overrides for `Equals(object)`, `GetHashCode()`
- implementations for `Equals(T)`, `==`, `!=`

## Installation

*All releases are marked as prerelease until I am confident in their robustness.*

In order to use `MacroRecords`, install the source generator from its Nuget repository: [RhoMicro.MacroRecords](https://www.nuget.org/packages/RhoMicro.MacroRecords/).

The attributes required for instructing the source generator may be found in their own Nuget repository: [RhoMicro.MacroRecords.Attributes](https://www.nuget.org/packages/RhoMicro.MacroRecords/)

## Feature Examples

Note: *Samples of generated code have been stripped of comments and regions for legibility. Any member generated by `MacroRecords` is supplied with a detailed documentation comment. The generated code is also segmented into `#region` fragments for ease of navigation.*

The `MacroRecords` source generator works by generating a partial type declaration. To instruct the generator, annotate your partial type with the `MacroRecordAttribute` found in the `RhoMicro.MacroRecord.Attributes` package.

### Using `MacroRecordAttribute`

The ``MacroRecordAttribute` is the primary annotation required to instruct the source generator.

The most primitive record you can define using `MacroRecords` therefore looks like this:

```cs
using RhoMicro.MacroRecords;
[MacroRecord]
partial class MyClass{}
```

The source code generated for the above definition will look something like this:
```cs
[System.Diagnostics.DebuggerDisplayAttribute("MyClass")]
partial class MyClass : IEquatable<MyClass>
{
    private MyClass()
    {
    }
    public static MyClass Create()
    {
        return new MyClass();
    }
    public override bool Equals(System.Object obj) => 
        obj is MyClass instance && Equals(instance);
    public bool Equals(MyClass other) => true;
    public override int GetHashCode() => 0;
    public static bool operator ==(MyClass left, MyClass right) => //elided
    public static bool operator !=(MyClass left, MyClass right) => //elided
}
```

Notice that a default private constructor has been generated. By default, `MacroRecords` prefers the factory method pattern implemented by `Create`.
In this simple example, that does not necessarily make much sense, however when introducing validation of fields, it provides more flexibility on how to create instances of your record type.

#### Disable Constructor Generation

If you wish to omit the constructor generation, unset the `GenerateConstructor` flag like so (the default is `true`):

```cs
[MacroRecord(GenerateConstructor = false)]
partial class MyClass{}
```

The source code generated for the above definition will look something like this:
```cs
[System.Diagnostics.DebuggerDisplayAttribute("MyClass")]
partial class MyClass : IEquatable<MyClass>
{
    public static MyClass Create()
    {
        return new MyClass();
    }
    //equality & hashing elided
}
```

As you can see, a private default constructor was not generated.
Only the factory method remains.

#### Generated Constructor Visibility

You may decide to set the visibility on the generated constructor like so (the default is `Visibility.Private`):

```cs
[MacroRecord(ConstructorVisibility = Visibility.Internal)]
partial class MyClass{}
```

The source code generated for the above definition will look something like this:
```cs
[System.Diagnostics.DebuggerDisplayAttribute("MyClass")]
partial class MyClass : IEquatable<MyClass>
{
    internal MyClass()
    {

    }
    public static MyClass Create()
    {
        return new MyClass();
    }
    //equality & hashing elided
}
```

#### Disable Debugger Display

You may disable the `DebuggerDisplayAttribute` generation by unsetting the `GenerateDebuggerDisplay` flaf (the default is `true`):

```cs
[MacroRecord(GenerateDebugDisplay = false)]
partial class MyClass { }
```

The source code generated for the above definition will look something like this:
```cs
partial class MyClass : IEquatable<MyClass>
{
    //body elided
}
```

### Using `FieldAttribute`

TODO

## TODO

- add abstract support
- better installation instructions

Credits for the name `MacroRecords` go to [knight](https://github.com/muhamedkarajic).
